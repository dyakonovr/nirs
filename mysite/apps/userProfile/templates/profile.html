{% extends 'header.html' %}
{% load static %}
{% block title %}Личный кабинет{% endblock title %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/styles.css' %}">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
    crossorigin="anonymous"></script>
<div class="col-7 mt-3 mb-5 mx-auto bg-info-subtle d-flex flex-column p-4 rounded-4">
    <h1 class="mb-4">Профиль</h1>
    <div class="tabs">
        <ul class="tabs__list mb-3 w-100">
            <li class="tabs__item w-50"><button class="tabs__btn fs-6 tabs__btn--active rounded-start-4"
                    data-tabs-path="data">Мои данные</button>
            </li>
            <!-- Rus: rounded-end-4 -->
            <li class="tabs__item w-50"><button class="tabs__btn fs-6" data-tabs-path="results">Результаты
                    тестов</button></li> 
            <li class="tabs__item w-50"><button class="tabs__btn fs-6 rounded-end-4" data-tabs-path="students">Мои ученики</button></li>
        </ul>
        <div class="tabs__content tabs__content--active" data-tabs-target="data">
            <div class="content d-flex flex-column">
                <div class="profile d-flex flex-column">
                    <p class="fs-5 mb-1 mt-0">Имя пользователя: <span class="fw-semibold">{{ currentUser.username }}</span></p>
                    <p class="fs-5 mb-1 mt-0">Электронная почта: <span class="fw-semibold">{{ currentUser.email }}</span></p>
                    <p class="fs-5 mb-2 mt-0">Номер телефона: <span class="fw-semibold">{{ currentUser.phoneNumber }}</span></p>
                    <span class="visually-hidden" data-user-id>{{currentUser.id}}</span>
                    <div class="mt-2">
                        <button type="submit" class="btn btn-warning" data-bs-toggle="modal"
                            data-bs-target="#exampleModal">Изменить
                            пароль</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="tabs__content" data-tabs-target="results">
            <div class="content d-flex flex-column">
                <div class="d-flex flex-column">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Тема</th>
                                <th scope="col" class="text-center">Результат</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for topic, score in scores.items %}
                                <tr>
                                    <th scope="row">{{ forloop.counter }}</th>
                                    <td>{{ topic }}</td>
                                    {% if topic.id == 23 %}
                                        <td class="text-center">{{ score }}/32</td>
                                    {% else %}
                                        <td class="text-center">{{ score }}/10</td>
                                    {% endif %}
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="tabs__content" data-tabs-target="students">
            <div class="content d-flex flex-column">
                <div class="d-flex flex-column">
                    {% if groups|length == 0 %}
                        <span id="group-empty" class="fs-5">Вы ещё не создали группы!</span>
                        <ul id="group-list" class="accordion__list visually-hidden p-0" style="list-style: none;"></ul>
                    {% else %}
                        <span id="group-empty" class="visually-hidden fs-4 fw-bold text-center">Вы ещё не создали группы!</span>
                        <ol id="group-list" style="padding-inline-start: 20px;">
                            {% for group in groups %}
                                <li class="group-item mt-3" data-group="{{group.group}}" data-group-id="{{group.id}}">
                                    <div class="d-flex align-items-center">
                                        <h3>{{group.group}}</h3>
                                        <button class="ms-2 btn btn-sm btn-danger" onclick="deleteGroup(event)">Удалить
                                            группу</button>
                                    </div>
                                    <ul class="p-0" style="list-style: none;" id="students-list">
                                        <li class="fs-5 visually-hidden" id="students-empty">Эта группа пуста!</li>
                                        <!-- FOR for students -->
                                        <li class="accordion">
                                            <div class="d-flex align-items-center accordion__control" aria-expanded="false"
                                                onclick="accordionOpen(event)">
                                                <button class="accordion__btn">
                                                    <span class="accordion__title">Ученик 1</span>
                                                </button>
                                                <button class="ms-auto btn btn-sm btn-warning" id="btn-delete" onclick="deleteStudent(event)">Удалить
                                                    ученика</button>
                                            </div>
                                            <div class="accordion__content" aria-hidden="true">
                                                <table class="table table-striped table-hover m-0">
                                                    <thead>
                                                        <tr>
                                                            <th scope="col">#</th>
                                                            <th scope="col">Тема</th>
                                                            <th scope="col" class="text-center">Результат</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for topic, score in scores.items %}
                                                        <tr>
                                                            <th scope="row">{{ forloop.counter }}</th>
                                                            <td>{{ topic }}</td>
                                                            {% if topic.id == 23 %}
                                                            <td class="text-center">{{ score }}/32</td>
                                                            {% else %}
                                                            <td class="text-center">{{ score }}/10</td>
                                                            {% endif %}
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        </li>
                                    </ul>
                                </li>
                            {% endfor %}
                        </ol>
                    {% endif %}
                    <div class="d-flex align-items-center mt-2">
                        <span class="fw-semibold fs-5">Добавить группу</span>
                        <form>
                            {% csrf_token %}
                            <div class="d-flex align-items-center">
                                {% for field in addGroupForm %}
                                    {{field}}
                                {% endfor %}
                                <button type="button" class="btn btn-primary ms-2" id="group-btn">Добавить группу</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" tabindex="-1" id="exampleModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header border-bottom-0">
                    <h5 class="modal-title">Изменить пароль</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="{% url 'profile' %}" method="post" id="change_password">
                        {% csrf_token %}
                        {% for field in changePasswordForm %}
                            {{field}}
                        {% endfor %}
                        <div class="modal-footer px-0 border-top-0">
                            <button type="submit" id="form-button" class="btn btn-primary d-flex me-auto ms-0">Сохранить пароль</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="{% static 'js/tabs.js' %}"></script>
<script src="{% static 'js/main.js' %}"></script>
<script src="{% static 'js/addGroups.js' %}"></script>
<script src="{% static 'js/accordion.js' %}"></script>
{% endblock content %}