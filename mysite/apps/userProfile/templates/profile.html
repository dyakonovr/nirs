{% extends 'header.html' %}
{% load static %}
{% block title %}Личный кабинет{% endblock title %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/styles.css' %}">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
    crossorigin="anonymous"></script>
<div class="col-7 mt-3 mb-5 mx-auto bg-info-subtle d-flex flex-column p-4 rounded-4">
    <h1 class="mb-4">Профиль</h1>
    <div class="tabs">
        <ul class="tabs__list mb-3 w-100">
            <li class="tabs__item w-50"><button class="tabs__btn fs-5 tabs__btn--active rounded-start-4"
                    data-tabs-path="data">Мои данные</button>
            </li>
            <li class="tabs__item w-50"><button class="tabs__btn fs-5" data-tabs-path="results">Результаты
                    тестов</button></li>
            <li class="tabs__item w-50"><button class="tabs__btn fs-5 rounded-end-4" data-tabs-path="students">Мои ученики</button></li>
        </ul>
        <div class="tabs__content tabs__content--active" data-tabs-target="data">
            <div class="content d-flex flex-column">
                <div class="profile d-flex flex-column">
                    <p class="fs-5 mb-1 mt-0">Имя пользователя: <span class="fw-semibold">{{ currentUser.username }}</span></p>
                    <p class="fs-5 mb-1 mt-0">Электронная почта: <span class="fw-semibold">{{ currentUser.email }}</span></p>
                    <p class="fs-5 mb-2 mt-0">Номер телефона: <span class="fw-semibold">{{ currentUser.phoneNumber }}</span></p>
                    <span class="visually-hidden">{{currentUser.id}}</span>
                    <div class="mt-2">
                        <button type="submit" class="btn btn-warning" data-bs-toggle="modal"
                            data-bs-target="#exampleModal">Изменить
                            пароль</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="tabs__content" data-tabs-target="results">
            <div class="content d-flex flex-column">
                <div class="d-flex flex-column">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th scope="col">#</th>
                                <th scope="col">Тема</th>
                                <th scope="col" class="text-center">Результат</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for topic, score in scores.items %}
                                <tr>
                                    <th scope="row">{{ forloop.counter }}</th>
                                    <td>{{ topic }}</td>
                                    {% if topic.id == 23 %}
                                        <td class="text-center">{{ score }}/32</td>
                                    {% else %}
                                        <td class="text-center">{{ score }}/10</td>
                                    {% endif %}
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="tabs__content" data-tabs-target="students">
            <div class="content d-flex flex-column">
                <div class="d-flex flex-column">
                    {% if groups|length == 0 %}
                        <span>Вы ещё не создали группы!</span>
                        <span>Добавить группу</span>
                        <form action="" method="post" class="form-control">
                            {% csrf_token %}
                            {% for field in addGroupForm %}
                                {{field}}
                            {% endfor %}
                            <button type="submit">Добавить пользователя</button>
                        </form>
                    {% else %}
                        {% for group in groups %}
                            <span data-group="{{group.group}}">{{forloop.counter}}. {{group.group}}</span>
                        {% endfor %}
                        <span>Добавить группу</span>
                        <form action="" method="post" class="form-control">
                            {% csrf_token %}
                            {% for field in addGroupForm %}
                                {{field}}
                            {% endfor %}
                            <button type="submit">Добавить пользователя</button>
                        </form>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" tabindex="-1" id="exampleModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header border-bottom-0">
                    <h5 class="modal-title">Изменить пароль</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form action="{% url 'profile' %}" method="post" id="change_password">
                        {% csrf_token %}
                        {% for field in changePasswordForm %}
                            {{field}}
                        {% endfor %}
                        <div class="modal-footer px-0 border-top-0">
                            <button type="submit" id="form-button" class="btn btn-primary d-flex me-auto ms-0">Сохранить пароль</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>
<script src="{% static 'js/tabs.js' %}"></script>
<script src="{% static 'js/main.js' %}"></script>
{% endblock content %}